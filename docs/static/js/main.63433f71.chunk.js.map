{"version":3,"sources":["pages/Home.tsx","components/FileChooser.tsx","components/Slider.tsx","icons/CloseIcon.tsx","containers/ImageFilter.tsx","icons/DownloadIcon.tsx","pages/FilterPage.tsx","utils/filedownloader.tsx","App.tsx","reportWebVitals.ts","containers/ErrorMessage.tsx","components/ErrorBoundary.tsx","index.tsx"],"names":["Home","handleStart","className","onClick","process","FileChooser","onSelected","React","useState","dragOver","setDragOver","inputRef","useRef","handleSelected","file","URL","createObjectURL","handleIgnore","e","preventDefault","stopPropagation","handleEnter","onDragEnter","onDragLeave","onDragOver","onDrop","dataTransfer","files","length","console","log","type","tabIndex","onKeyUp","key","current","click","accept","onChange","target","ref","Slider","value","min","max","step","parseInt","currentTarget","CloseIcon","props","width","height","viewBox","fill","xmlns","fillRule","clipRule","d","stroke","strokeWidth","strokeLinecap","strokeLinejoin","MAIN_IMAGE_KEY","getScaleAndPositionContain","oImg","canvas","canvasWidth","canvasHeight","imgWidth","imgHeight","scale","Math","left","top","getMainImage","getObjects","find","o","name","AvailableFilters","defaultStrength","createFilters","strength","fabric","Image","filters","Blur","blur","Vintage","Sepia","forwardRef","ImageFilter","url","useFabricJSEditor","editor","onReady","useImperativeHandle","getImageUrl","toDataURL","format","quality","handleResize","mainImage","renderAll","useEffect","window","addEventListener","removeEventListener","fromURL","selectable","hoverCursor","add","Filters","onApplyFilter","filter","splice","push","applyFilters","selected","setSelected","map","Filter","setStrength","valueMode","setValueMode","handleApply","getScaleAndPositionCover","onPointerUp","SelectValue","onClose","DownloadIcon","version","FilterPage","setUrl","imageRef","dataUrl","filename","a","document","createElement","href","download","clickHandler","setTimeout","revokeObjectURL","downloadUrl","App","started","setStarted","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ErrorMessage","ErrorBoundary","state","hasError","error","errorInfo","this","children","Component","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.63433f71.chunk.js","sourcesContent":["import \"./home.css\";\n\nexport default function Home({ handleStart }: { handleStart: () => void }) {\n  return (\n    <>\n      <header className=\"flex-col\">\n        <h1>Instagram like photo editor.</h1>\n      </header>\n      <div className=\"home__container flex-col\">\n        <p>This is a project to test fabricjs, typescript and reactjs.</p>\n        <p>\n          It lets you select a photo, apply a filter to it and download it.\n          <br />\n          It is responsive.\n          <br />\n          It has a good test suit.\n        </p>\n        <button className=\"home__start\" onClick={handleStart}>\n          Start\n        </button>\n      </div>\n      <footer className=\"home__footer flex-col\">\n        <p className=\"home__footer-name\">By Kayvan Arianpour</p>\n        <p className=\"home__footer-version\">Version: {process.env.REACT_APP_VERSION}</p>\n      </footer>\n    </>\n  );\n}\n","import React from \"react\";\nimport \"./FileChooser.css\";\n\nexport function FileChooser({\n  onSelected,\n}: {\n  onSelected: (url: string) => void;\n}) {\n  const [dragOver, setDragOver] = React.useState(false);\n  const inputRef = React.useRef<HTMLInputElement>(null);\n\n  const handleSelected = (file: File) => {\n    onSelected(URL.createObjectURL(file));\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    handleIgnore(e);\n    if (e.target.files && e.target.files.length > 0) {\n      const file = e.target.files[0];\n      if (file.type === \"image/jpeg\") {\n        handleSelected(file);\n      }\n    }\n  };\n\n  const handleKey = (e: React.KeyboardEvent) => {\n    if (e.key === \" \" || e.key === \"Enter\") {\n      inputRef.current?.click();\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent<HTMLInputElement>) => {\n    handleIgnore(e);\n    setDragOver(false);\n    if (e.dataTransfer?.files && e.dataTransfer?.files.length > 0) {\n      const file = e.dataTransfer.files[0];\n      console.log(file.type);\n      if (file.type === \"image/jpeg\") {\n        handleSelected(file);\n      }\n    }\n  };\n\n  const handleIgnore = (e: React.SyntheticEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleEnter = (e: React.DragEvent<HTMLInputElement>) => {\n    handleIgnore(e);\n    setDragOver(true);\n  };\n\n  const handleLeave = (e: React.DragEvent<HTMLInputElement>) => {\n    handleIgnore(e);\n    setDragOver(false);\n  };\n\n  return (\n    <div\n      className={`file-chooser__container flex-col center ${\n        dragOver ? \"file-chooser__container__dragover\" : \"\"\n      }`}\n      onDragEnter={handleEnter}\n      onDragLeave={handleLeave}\n      onDragOver={handleEnter}\n      onDrop={handleDrop}\n    >\n      <label tabIndex={0} className=\"file-chooser__label\" onKeyUp={handleKey}>\n        <span>\n          Click to select a photo\n          <br />\n          or\n          <br />\n          drop it here\n        </span>\n        <input\n          type=\"file\"\n          accept=\"image/jpeg\"\n          onChange={handleChange}\n          className=\"hidden\"\n          ref={inputRef}\n        />\n      </label>\n    </div>\n  );\n}\n","import \"./Slider.css\";\n\nexport default function Slider({\n  value,\n  onChange,\n}: {\n  value: number;\n  onChange: (value: number) => void;\n}) {\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    onChange(parseInt(e.currentTarget.value) / 100);\n  };\n\n  return (\n    <div className=\"\">\n      <input\n        type=\"range\"\n        min=\"1\"\n        max=\"100\"\n        step=\"5\"\n        value={value * 100}\n        className=\"slider\"\n        onChange={handleChange}\n      />\n    </div>\n  );\n}\n","import React from \"react\";\n\nexport default function CloseIcon(props: React.ComponentProps<\"svg\">) {\n  return (\n    <svg\n      {...props}\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M6 6 L18 18\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M18 6 L6 18\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </svg>\n  );\n}\n","import React, {\n  ForwardedRef,\n  forwardRef,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from \"react\";\nimport \"./ImageFilter.css\";\nimport { FabricJSCanvas, useFabricJSEditor } from \"fabricjs-react\";\nimport { fabric } from \"fabric\";\nimport Slider from \"../components/Slider\";\nimport CloseIcon from \"../icons/CloseIcon\";\n\nconst MAIN_IMAGE_KEY = \"main-image\";\n\nfunction getScaleAndPositionContain(oImg: fabric.Image, canvas: fabric.Canvas) {\n  const canvasWidth = canvas.width!;\n  const canvasHeight = canvas.height!;\n  const imgWidth = oImg.width!;\n  const imgHeight = oImg.height!;\n  const scale = Math.min(canvasHeight / imgHeight, canvasWidth / imgWidth);\n  const left = (canvasWidth - imgWidth * scale) / 2;\n  const top = (canvasHeight - imgHeight * scale) / 2;\n  return { scale, left, top };\n}\n\nfunction getScaleAndPositionCover(oImg: fabric.Image, canvas: fabric.Canvas) {\n  const canvasWidth = canvas.width!;\n  const canvasHeight = canvas.height!;\n  const imgWidth = oImg.width!;\n  const imgHeight = oImg.height!;\n  const scale = Math.max(canvasHeight / imgHeight, canvasWidth / imgWidth);\n  const left = (canvasWidth - imgWidth * scale) / 2;\n  const top = (canvasHeight - imgHeight * scale) / 2;\n  return { scale, left, top };\n}\n\nfunction getMainImage(canvas: fabric.Canvas | undefined) {\n  if (!canvas) return;\n  const mainImage = canvas.getObjects().find((o) => o.name === MAIN_IMAGE_KEY);\n  return mainImage as fabric.Image;\n}\n\ninterface FilterType {\n  name: string;\n  defaultStrength: number;\n  createFilters?: (strength: number) => fabric.IBaseFilter[];\n}\n\nconst AvailableFilters: FilterType[] = [\n  {\n    name: \"No filter\",\n    defaultStrength: 0,\n  },\n  {\n    name: \"Blur\",\n    defaultStrength: 0.1,\n    createFilters: (strength) => {\n      return [\n        new (fabric.Image.filters as any).Blur({\n          blur: strength,\n        }),\n      ];\n    },\n  },\n  {\n    name: \"Vintage\",\n    defaultStrength: 0.2,\n    createFilters: (strength) => {\n      return [new (fabric.Image.filters as any).Vintage()];\n    },\n  },\n  {\n    name: \"Sepia\",\n    defaultStrength: 0.2,\n    createFilters: (strength) => {\n      return [new fabric.Image.filters.Sepia()];\n    },\n  },\n];\n\ntype ImageFilterProps = { url: string };\n\nexport type ImageFilterRef = {\n  getImageUrl: () => string | undefined;\n};\n\nexport default forwardRef<ImageFilterRef, ImageFilterProps>(ImageFilter);\n\nfunction ImageFilter(\n  { url }: ImageFilterProps,\n  ref: ForwardedRef<ImageFilterRef>\n) {\n  const { editor, onReady } = useFabricJSEditor();\n\n  useImperativeHandle(ref, () => ({\n    getImageUrl: () => {\n      return editor?.canvas.toDataURL({\n        format: \"jpeg\",\n        quality: 0.85,\n      });\n    },\n  }));\n\n  const handleApplyFilter = (filter: FilterType, strength: number) => {\n    const mainImage = getMainImage(editor?.canvas);\n    if (!mainImage) return;\n    mainImage.filters?.splice(0, mainImage.filters.length);\n    mainImage.filters?.push(...(filter.createFilters?.(strength) || []));\n    mainImage.applyFilters();\n    editor!.canvas.renderAll();\n  };\n\n  const handleResize = () => {\n    const mainImage = getMainImage(editor?.canvas);\n    if (mainImage) {\n      const { scale, left, top } = getScaleAndPositionContain(\n        mainImage,\n        editor!.canvas\n      );\n      mainImage.scale(scale);\n      mainImage.left = left;\n      mainImage.top = top;\n      editor!.canvas.renderAll();\n    }\n  };\n\n  useEffect(() => {\n    if (editor) {\n      window.addEventListener(\"resize\", handleResize);\n    }\n    return () => {\n      window.removeEventListener(\"resize\", handleResize);\n    };\n  });\n\n  useEffect(() => {\n    if (!editor) return;\n    const mainImage = getMainImage(editor?.canvas);\n    if (mainImage) return;\n\n    fabric.Image.fromURL(url, function (oImg) {\n      oImg.name = MAIN_IMAGE_KEY;\n      const { scale, left, top } = getScaleAndPositionContain(\n        oImg,\n        editor!.canvas\n      );\n      oImg.scale(scale);\n      oImg.left = left;\n      oImg.top = top;\n      oImg.selectable = false;\n      oImg.hoverCursor = \"default\";\n      editor.canvas.add(oImg);\n    });\n  });\n\n  return (\n    <div className=\"image-filter__root flex-col flex-grow\">\n      <FabricJSCanvas\n        className=\"image-filter__content flex-grow\"\n        onReady={onReady}\n      ></FabricJSCanvas>\n      <div className=\"filter__options-container relative\">\n        {<Filters url={url} onApplyFilter={handleApplyFilter} />}\n      </div>\n    </div>\n  );\n}\n\nfunction Filters({\n  url,\n  onApplyFilter,\n}: {\n  url: string;\n  onApplyFilter: (filter: FilterType, strength: number) => void;\n}) {\n  const [selected, setSelected] = useState(\"\");\n\n  const handleSelected = (name: string) => {\n    setSelected(name);\n  };\n\n  return (\n    <div className=\"filter__options flex-row\">\n      {AvailableFilters.map((filter) => (\n        <Filter\n          key={filter.name}\n          url={url}\n          filter={filter}\n          onApplyFilter={onApplyFilter}\n          selected={selected}\n          onSelected={handleSelected}\n        />\n      ))}\n    </div>\n  );\n}\n\nfunction Filter({\n  url,\n  filter,\n  onApplyFilter,\n  selected,\n  onSelected,\n}: {\n  url: string;\n  filter: FilterType;\n  onApplyFilter: (filter: FilterType, strength: number) => void;\n  selected: string;\n  onSelected: (name: string) => void;\n}) {\n  const { editor, onReady } = useFabricJSEditor();\n  const [strength, setStrength] = useState(filter.defaultStrength);\n  const [valueMode, setValueMode] = useState(false);\n\n  const handleApply = () => {\n    if (selected === filter.name) {\n      if (filter.createFilters) {\n        setValueMode(true);\n      }\n    } else {\n      onApplyFilter(filter, strength);\n      onSelected(filter.name);\n    }\n  };\n\n  const handleClose = () => {\n    setValueMode(false);\n  };\n\n  const handleClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    handleApply();\n  };\n\n  const handleKeyup = (e: React.KeyboardEvent) => {\n    if (e.key === \" \" || e.key === \"Enter\") {\n      e.preventDefault();\n      e.stopPropagation();\n      handleApply();\n    }\n  };\n\n  const handleChange = (value: number) => {\n    setStrength(value);\n    onApplyFilter(filter, value);\n  };\n\n  useEffect(() => {\n    if (!editor) return;\n    const mainImage = getMainImage(editor?.canvas);\n    if (mainImage) return;\n\n    fabric.Image.fromURL(url, function (oImg) {\n      oImg.name = MAIN_IMAGE_KEY;\n      const { scale, left, top } = getScaleAndPositionCover(\n        oImg,\n        editor!.canvas\n      );\n      oImg.scale(scale);\n      oImg.selectable = false;\n      oImg.left = left;\n      oImg.top = top;\n      oImg.filters?.push(...(filter.createFilters?.(strength) || []));\n      oImg.applyFilters();\n      oImg.hoverCursor = \"pointer\";\n      editor.canvas.add(oImg);\n    });\n  });\n\n  return (\n    <div\n      className=\"flex-col\"\n      onKeyUp={handleKeyup}\n      onPointerUp={handleClick}\n      tabIndex={0}\n    >\n      <label className=\"filter__label\">{filter.name}</label>\n      <FabricJSCanvas\n        className=\"filter__thumbnail\"\n        onReady={onReady}\n      ></FabricJSCanvas>\n      {valueMode && (\n        <SelectValue\n          value={strength}\n          onChange={handleChange}\n          onClose={handleClose}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction SelectValue({\n  value,\n  onChange,\n  onClose,\n}: {\n  value: number;\n  onChange: (value: number) => void;\n  onClose: () => void;\n}) {\n  return (\n    <div className=\"filter__select-value flex-row center\">\n      <button\n        className=\"icon-button filter__select-value-close\"\n        onClick={onClose}\n      >\n        <CloseIcon />\n      </button>\n      <Slider value={value} onChange={onChange} />\n    </div>\n  );\n}\n","import React from \"react\";\r\n\r\nexport default function DownloadIcon(props: React.ComponentProps<\"svg\">) {\r\n  return (\r\n    <svg\r\n      {...props}\r\n      version=\"1.1\"\r\n      width=\"24\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 512 512\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n    >\r\n      <g>\r\n        <path\r\n          d=\"M426.635,164.217C402.969,69.94,307.358,12.698,213.08,36.364C139.404,54.858,85.907,118.535,80.395,194.297\r\n\t\t\t\tc-52.313,8.627-87.728,58.028-79.101,110.341c7.669,46.507,47.967,80.566,95.101,80.379h64v-32h-64c-35.346,0-64-28.654-64-64\r\n\t\t\t\tc0-35.346,28.654-64,64-64c8.837,0,16-7.163,16-16c-0.08-79.529,64.327-144.065,143.856-144.144\r\n\t\t\t\tc68.844-0.069,128.107,48.601,141.424,116.144c1.315,6.744,6.788,11.896,13.6,12.8c43.742,6.229,74.151,46.738,67.923,90.479\r\n\t\t\t\tc-5.593,39.278-39.129,68.523-78.803,68.721h-48v32h48c61.856-0.187,111.848-50.483,111.66-112.339\r\n\t\t\t\tC511.899,221.187,476.655,176.437,426.635,164.217z\"\r\n          fill=\"currentcolor\"\r\n        />\r\n        <path\r\n          d=\"M272.395,426.457v-153.44h-32v153.44l-36.64-36.64l-22.56,22.56l64,64c6.241,6.204,16.319,6.204,22.56,0l64-64\r\n\t\t\t\tl-22.56-22.56L272.395,426.457z\"\r\n          fill=\"currentcolor\"\r\n        />\r\n      </g>\r\n    </svg>\r\n  );\r\n}\r\n","import React, { useRef } from \"react\";\nimport { FileChooser } from \"../components/FileChooser\";\nimport ImageFilter, { ImageFilterRef } from \"../containers/ImageFilter\";\nimport CloseIcon from \"../icons/CloseIcon\";\nimport DownloadIcon from \"../icons/DownloadIcon\";\nimport { downloadUrl } from \"../utils/filedownloader\";\nimport \"./FilterPage.css\";\n\nexport default function FilterPage({ onClose }: { onClose: () => void }) {\n  const [url, setUrl] = React.useState(\"\");\n  const imageRef = useRef<ImageFilterRef>(null);\n\n  const handleSelected = (url: string) => {\n    setUrl(url);\n  };\n\n  const handleClose = () => {\n    if (url) {\n      setUrl(\"\");\n    } else {\n      onClose();\n    }\n  };\n\n  const handleDownload = () => {\n    const dataUrl = imageRef.current?.getImageUrl();\n    if (dataUrl) {\n      downloadUrl(dataUrl, \"image.jpeg\");\n    }\n  };\n\n  return (\n    <>\n      <header className=\"filter-page__header flex-row\">\n        {url && (\n          <button className=\"icon-button\" onClick={handleDownload}>\n            <DownloadIcon />\n          </button>\n        )}\n        <div className=\"spacer\" />\n        <button className=\"icon-button\" onClick={handleClose}>\n          <CloseIcon />\n        </button>\n      </header>\n      <section className=\"filter-page__content flex-col\">\n        {!url && <FileChooser onSelected={handleSelected} />}\n        {url && <ImageFilter url={url} ref={imageRef} />}\n      </section>\n    </>\n  );\n}\n","export function downloadUrl(url: string, filename: string) {\n  const a = document.createElement(\"a\");\n\n  a.href = url;\n  a.download = filename || \"download\";\n\n  const clickHandler = () => {\n    setTimeout(() => {\n      URL.revokeObjectURL(url);\n      a.removeEventListener(\"click\", clickHandler);\n    }, 150);\n  };\n\n  a.addEventListener(\"click\", clickHandler, false);\n\n  a.click();\n\n  return a;\n}\n","import React from \"react\";\nimport \"./App.css\";\nimport Home from \"./pages/Home\";\nimport FilterPage from \"./pages/FilterPage\";\n\nfunction App() {\n  const [started, setStarted] = React.useState(false);\n\n  const handleStart = () => {\n    setStarted(true);\n  };\n\n  const handleClose = () => {\n    setStarted(false);\n  };\n\n  return (\n    <div className=\"App flex-col\">\n      {!started && <Home handleStart={handleStart} />}\n      {started && <FilterPage onClose={handleClose} />}\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","export default function ErrorMessage() {\n  return (\n    <section className=\"flex-col center\">\n      <h1>Something went wrong.</h1>\n      <p>Please check if you are using the latest version of you browser.</p>\n      <div className=\"\">\n        <p className=\"\">Tested versions are:</p>\n        <ul>\n          <li>Desctop Chrome 91</li>\n          <li>Desctop FireFox 89</li>\n          <li>Desctop Safari 14</li>\n          <li>Mobile Chrome 91</li>\n          <li>Mobile Samsung Internet 14</li>\n        </ul>\n      </div>\n    </section>\n  )\n}","import React, { ErrorInfo } from \"react\";\nimport ErrorMessage from \"../containers/ErrorMessage\";\n\nclass ErrorBoundary extends React.Component<{}, {hasError: boolean}> {\n  constructor(props: {}) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error: any) {\n    return { hasError: true };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    // We have to use a service to log the errors\n    console.error()\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return <ErrorMessage/>;\n    }\n\n    return this.props.children; \n  }\n}\n\nexport default ErrorBoundary;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport ErrorBoundary from \"./components/ErrorBoundary\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <ErrorBoundary>\n      <App />\n    </ErrorBoundary>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}